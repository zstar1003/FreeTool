import{r as t,j as e}from"./index-BcR3zBF8.js";import"./react-vendor-DS08_OVb.js";import"./pdf-vendor-B1Z1FYJ2.js";const D=()=>{const[m,w]=t.useState("7"),[i,B]=t.useState("FP16"),[a,f]=t.useState("inference"),[x,P]=t.useState("1"),[o,M]=t.useState("2048"),[g,T]=t.useState(!1),[n,S]=t.useState("Adam"),[y,C]=t.useState(!1),[s,j]=t.useState(null),F={FP32:4,FP16:2,BF16:2,INT8:1,INT4:.5};t.useEffect(()=>{const r=parseFloat(m),d=parseInt(x),c=parseInt(o);if(!r||r<=0||!d||d<=0||!c||c<=0){j(null);return}const b=r*1e9,h=F[i],k=b*h/1024**3,z=g?.2:1,N=d*c*r*12*z/1e3,v=a==="inference"?d*c*r*.5*h/2e3:0;let u=0,p=0;a==="training"&&(u=b*(y?2:h)/1024**3,p=b*(n==="SGD"?1:2)*4/1024**3);const A=k+N+u+p+v;j({modelMemory:k,activationMemory:N,gradientMemory:u,optimizerMemory:p,kvCacheMemory:v,totalMemory:A})},[m,i,a,x,o,g,n,y]);const l=r=>r<1?`${(r*1024).toFixed(2)} MB`:`${r.toFixed(2)} GB`,G=r=>r<=8?"RTX 3060 Ti (8GB), RTX 4060 Ti (8GB)":r<=12?"RTX 3060 (12GB), RTX 4060 Ti (16GB)":r<=16?"RTX 4080 (16GB), RTX 3090 (24GB)":r<=24?"RTX 3090/4090 (24GB), A5000 (24GB)":r<=40?"A100 (40GB), A6000 (48GB)":r<=48?"A6000 (48GB)":r<=80?"A100 (80GB), H100 (80GB)":"需要多卡并行或模型并行";return e.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex w-full max-w-6xl flex-col items-center gap-2 text-center mb-8",children:[e.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"显存计算器"}),e.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"计算 AI 模型训练和推理所需的显存大小"})]}),e.jsx("div",{className:"w-full max-w-6xl rounded-xl border border-gray-200 dark:border-gray-700/50 bg-white dark:bg-gray-800/20 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6",children:[e.jsx("div",{className:"flex flex-col gap-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"settings"}),"参数设置"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"模型参数量 (Billion)"}),e.jsx("input",{type:"number",value:m,onChange:r=>w(r.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"例如: 7 (7B), 13 (13B), 70 (70B)",step:"0.1",min:"0.01"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"常见模型: Llama 7B, Llama 13B, Llama 70B, GPT-3 175B"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"精度 (Precision)"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:["FP32","FP16","BF16","INT8","INT4"].map(r=>e.jsx("button",{onClick:()=>B(r),className:`px-3 py-2 rounded-lg text-sm font-medium transition-all ${i===r?"bg-primary text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:r},r))}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[i==="FP32"&&"32位浮点 (4 bytes) - 最高精度",i==="FP16"&&"16位浮点 (2 bytes) - 常用于训练和推理",i==="BF16"&&"16位浮点 (2 bytes) - 更好的数值范围",i==="INT8"&&"8位整数 (1 byte) - 量化推理",i==="INT4"&&"4位整数 (0.5 bytes) - 极致量化"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"模式 (Mode)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>f("inference"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${a==="inference"?"bg-primary text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"推理 (Inference)"}),e.jsx("button",{onClick:()=>f("training"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${a==="training"?"bg-primary text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:"训练 (Training)"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"批次大小 (Batch Size)"}),e.jsx("input",{type:"number",value:x,onChange:r=>P(r.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"例如: 1, 4, 8, 16",step:"1",min:"1"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"序列长度 (Sequence Length)"}),e.jsx("input",{type:"number",value:o,onChange:r=>M(r.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary",placeholder:"例如: 512, 1024, 2048, 4096",step:"128",min:"1"})]}),a==="training"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:r=>T(r.target.checked),className:"w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary dark:focus:ring-primary dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"梯度检查点 (Gradient Checkpointing)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-6",children:"显著降低激活内存，但会增加训练时间"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:r=>C(r.target.checked),className:"w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded focus:ring-primary dark:focus:ring-primary dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"混合精度训练 (Mixed Precision)"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 ml-6",children:"使用 FP16 梯度降低内存占用"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"优化器 (Optimizer)"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["Adam","AdamW","SGD"].map(r=>e.jsx("button",{onClick:()=>S(r),className:`px-3 py-2 rounded-lg text-sm font-medium transition-all ${n===r?"bg-primary text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:r},r))}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:n==="SGD"?"SGD 占用内存较少":"Adam/AdamW 需要额外的动量和方差状态"})]})]})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined",children:"analytics"}),"计算结果"]}),s?e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary/10 to-primary/5 dark:from-primary/20 dark:to-primary/10 rounded-xl p-6 border border-primary/20",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"总显存需求"}),e.jsx("p",{className:"text-4xl font-bold text-primary mb-2",children:l(s.totalMemory)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["推荐显卡: ",G(s.totalMemory)]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/50 rounded-xl p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"显存分解"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"模型权重"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l(s.modelMemory)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"激活内存"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l(s.activationMemory)})]}),a==="inference"&&s.kvCacheMemory>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"KV Cache"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l(s.kvCacheMemory)})]}),a==="training"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"梯度内存"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l(s.gradientMemory)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"优化器状态"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:l(s.optimizerMemory)})]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-600 dark:text-blue-400 text-xl",children:"info"}),e.jsxs("div",{className:"flex-1 text-xs text-blue-800 dark:text-blue-300 space-y-1",children:[e.jsx("p",{className:"font-medium",children:"注意事项:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[e.jsx("li",{children:"以上计算为估算值，实际显存占用会因模型架构、框架实现等因素有所差异"}),e.jsx("li",{children:"建议预留 10-20% 的显存余量以应对峰值占用"}),e.jsx("li",{children:"使用量化技术 (INT8/INT4) 可显著降低显存需求"}),a==="training"&&e.jsx("li",{children:"使用梯度检查点、ZeRO 等技术可进一步优化显存占用"})]})]})]})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-400 dark:text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-5xl mb-2 block opacity-50",children:"calculate"}),e.jsx("p",{className:"text-sm",children:"请输入有效的参数进行计算"})]})})]})]})})]})};export{D as default};
