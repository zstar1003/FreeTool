import{r as l,j as e}from"./index-CShpVW34.js";import"./react-vendor-DS08_OVb.js";import"./pdf-vendor-1qLBXhNR.js";function ne(r,c){let a;return(...k)=>{a&&clearTimeout(a),a=setTimeout(()=>r(...k),c)}}const oe=()=>new Promise((r,c)=>{if(window.DataGridXL){r();return}const a=document.createElement("script");a.src="/libs/datagridxl/datagridxl2.js",a.async=!0,a.onload=()=>r(),a.onerror=()=>c(new Error("load_failed")),document.head.appendChild(a)}),H=(r,c)=>Array.from({length:r},()=>Array.from({length:c},()=>"")),z=(r,c,a)=>Math.max(c,Math.min(a,r)),O=(r,c,a)=>Array.from({length:c},(k,d)=>Array.from({length:a},(v,g)=>{var N;return((N=r[d])==null?void 0:N[g])??""})),_=r=>r.replace(/\r\n/g,`
`).replace(/\r/g,`
`),le=r=>r.replace(/\|/g,"\\|").replace(/\n/g,"<br>"),ie=r=>r.replace(/\\/g,"\\textbackslash{}").replace(/([{}_$&#%])/g,"\\$1").replace(/\^/g,"\\^{}").replace(/~/g,"\\~{}").replace(/\n/g," "),xe=()=>{const[r,c]=l.useState(4),[a,k]=l.useState(4),[d,v]=l.useState(()=>H(4,4)),[g,N]=l.useState("markdown"),[h,U]=l.useState(!0),[T,C]=l.useState("loading"),[P,G]=l.useState(0),[R,S]=l.useState(!1),[W,D]=l.useState(!1),b=l.useRef(null),w=l.useRef(null),A=l.useRef(d);l.useEffect(()=>{A.current=d},[d]),l.useEffect(()=>{let t=!1;const o=()=>new Promise((s,x)=>{if(window.DataGridXL){s();return}const n=Date.now(),i=window.setInterval(()=>{window.DataGridXL?(window.clearInterval(i),s()):Date.now()-n>8e3&&(window.clearInterval(i),x(new Error("timeout")))},120)});return(async()=>{if(!b.current&&(await new Promise(p=>setTimeout(p,100)),!b.current))return;const s=b.current;let x=0;for(;(s.offsetWidth===0||s.offsetHeight===0)&&x<10;)await new Promise(p=>setTimeout(p,50)),x++;C("loading");try{await oe(),await o()}catch{t||C("error");return}if(t||!b.current||!window.DataGridXL)return;s.id||(s.id="dgxl-table-grid");const n=new window.DataGridXL(s.id,{data:A.current.map(p=>[...p]),colHeaderLabelType:"letters",rowHeaderLabelType:"numbers",allowInsertRows:!1,allowDeleteRows:!1,allowMoveRows:!1,allowInsertCols:!1,allowDeleteCols:!1,allowMoveCols:!1,fillCellsDirection:"xy",rowHeight:38});w.current=n,C("ready");const i=p=>{if(n.getData&&typeof n.getData=="function")try{const j=n.getData();if(Array.isArray(j)){v(j.map(f=>Array.isArray(f)?f.map(y=>_(y==null?"":String(y))):[]));return}}catch{}if(!p)return;const{rowIds:te=[],colIds:re=[],values:E=[]}=p;v(j=>{const f=j.map(y=>[...y]);return te.forEach((y,X)=>{const F=y-1;re.forEach((ae,I)=>{var M;const se=ae-1;f[F]&&typeof((M=E[X])==null?void 0:M[I])<"u"&&(f[F][se]=_(String(E[X][I]??"")))})}),f})},u=ne(i,100);n.events.on("cellvaluechange",u),n.events.on("change",u),n.events.on("afterchange",u),n.events.on("$setcellvaluesbatch",u),n.events.on("$fillcells",u),n.events.on("$clearcells",u),n.events.on("documentchange",u),n.events.on("ready",()=>{i()}),setTimeout(()=>{!t&&w.current&&i()},200)})(),()=>{var s;t=!0,(s=w.current)!=null&&s.destroy&&w.current.destroy(),w.current=null}},[P]);const L=(t,o,m)=>{c(o),k(m),v(t),G(s=>s+1)},B=t=>{const o=z(t,1,20);o!==r&&L(O(d,o,a),o,a)},V=t=>{const o=z(t,1,12);o!==a&&L(O(d,r,o),r,o)},q=()=>{L(H(r,a),r,a)},J=()=>{const t=d.map(i=>i.map(u=>le(u.trim())));if(!h)return t.map(i=>`| ${i.join(" | ")} |`).join(`
`);const o=t[0]??Array.from({length:a},()=>""),m=t.slice(1),s=`| ${o.join(" | ")} |`,x=`| ${o.map(()=>"---").join(" | ")} |`,n=m.map(i=>`| ${i.join(" | ")} |`);return[s,x,...n].join(`
`)},K=()=>{const t=Array.from({length:a},()=>"l").join(""),o=d.map((m,s)=>{const x=m.map(n=>ie(n.trim())).join(" & ");return h&&s===0?`${x} \\\\n\\hline`:`${x} \\\\`}).join(`
`);return["\\begin{tabular}{|"+t.split("").join("|")+"|}","\\hline",o,"\\hline","\\end{tabular}"].join(`
`)},Q=()=>`
<table style="border-collapse:collapse;width:100%;font-family:Arial, sans-serif;font-size:13px;">
    ${d.map((o,m)=>`<tr>${o.map(x=>{const n=h&&m===0?"th":"td",i=x.replace(/\n/g,"<br>");return`<${n} style="border:1px solid #ccc;padding:6px;">${i||"&nbsp;"}</${n}>`}).join("")}</tr>`).join("")}
</table>`.trim(),$=l.useMemo(()=>{switch(g){case"latex":return K();case"word":return Q();default:return J()}},[g,d,h,r,a]),Y=()=>{const t=g==="markdown"?"md":g==="latex"?"tex":"doc",o=new Blob([$],{type:"text/plain;charset=utf-8"}),m=URL.createObjectURL(o),s=document.createElement("a");s.href=m,s.download=`table-convert.${t}`,s.click(),URL.revokeObjectURL(m)},Z=async()=>{try{await navigator.clipboard.writeText($),S(!0),D(!1),window.setTimeout(()=>{D(!0)},1700),window.setTimeout(()=>{S(!1),D(!1)},2e3)}catch(t){console.error("Copy failed",t)}},ee=()=>G(t=>t+1);return e.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex w-full max-w-7xl flex-col items-center gap-2 text-center mb-8",children:[e.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"表格格式转换"}),e.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"基于 DataGridXL 的可编辑表格，实时导出 Markdown / LaTeX / Word。"})]}),e.jsxs("div",{className:"w-full max-w-7xl flex flex-col gap-6",children:[R&&e.jsx("div",{className:`fixed top-8 left-1/2 -translate-x-1/2 z-50 ${W?"animate-fade-out-up":"animate-fade-in-down"}`,children:e.jsxs("div",{className:"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"check_circle"}),e.jsx("span",{className:"font-medium",children:"已复制到剪贴板!"})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:["行数",e.jsx("input",{type:"number",min:1,max:20,value:r,onChange:t=>B(Number(t.target.value)),className:"w-20 rounded-md border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-1 text-sm"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:["列数",e.jsx("input",{type:"number",min:1,max:12,value:a,onChange:t=>V(Number(t.target.value)),className:"w-20 rounded-md border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-1 text-sm"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:t=>U(t.target.checked),className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),"第一行作为表头"]}),e.jsx("button",{onClick:q,className:"ml-auto text-sm font-medium text-primary hover:underline",children:"清空表格"})]}),e.jsxs("div",{className:"relative rounded-lg border border-dashed border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30 min-h-[360px]",children:[e.jsx("div",{ref:b,className:"h-[360px] w-full overflow-hidden rounded-lg"}),T!=="ready"&&e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-3 rounded-lg bg-white/80 dark:bg-gray-900/80 text-sm text-gray-600 dark:text-gray-300",children:T==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"正在加载 DataGridXL..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"DataGridXL 加载失败，请检查网络后重试。"}),e.jsx("button",{onClick:ee,className:"text-primary font-semibold",children:"重新加载"})]})})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center rounded-lg bg-gray-100 dark:bg-white/5 p-1.5",children:["markdown","latex","word"].map(t=>e.jsx("button",{onClick:()=>N(t),className:`flex-1 rounded-md px-3 py-2 text-sm font-semibold capitalize transition-all ${g===t?"bg-white text-gray-900 shadow-sm dark:bg-gray-700 dark:text-gray-50":"text-gray-500 dark:text-gray-400"}`,children:t},t))}),e.jsx("textarea",{value:$,readOnly:!0,className:"min-h-[320px] flex-1 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 px-4 py-3 text-sm font-mono text-gray-800 dark:text-gray-100"}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["支持直接复制或下载为 ",g==="markdown"?".md":g==="latex"?".tex":".doc"," 文件。"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:Z,className:"flex items-center gap-1 rounded-lg border border-gray-300 dark:border-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"content_copy"}),e.jsx("span",{children:R?"已复制!":"复制"})]}),e.jsxs("button",{onClick:Y,className:"flex items-center gap-1 rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow hover:opacity-90",style:{backgroundColor:"#607AFB"},children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"download"}),"下载"]})]})]})]})]})]})]})};export{xe as default};
