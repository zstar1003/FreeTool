import{r as o,j as r}from"./index-DbOqXvr9.js";import"./react-vendor-DS08_OVb.js";import"./pdf-vendor-1qLBXhNR.js";const ke=()=>{const[ye,A]=o.useState(null),[V,O]=o.useState(""),[c,Z]=o.useState("select"),[w,ee]=o.useState("pen"),[I,te]=o.useState("#FF0000"),[N,re]=o.useState(3),[T,ae]=o.useState(10),[h,y]=o.useState(null),[B,k]=o.useState(!1),[G,v]=o.useState(null),[W,M]=o.useState(null),[d,S]=o.useState(null),[q,J]=o.useState(!1),[m,H]=o.useState(null),[C,R]=o.useState(0),[z,F]=o.useState(0),[P,E]=o.useState(0),[U,L]=o.useState(0),[_,se]=o.useState(!0),u=o.useRef(null),le=o.useRef(null),x=o.useRef([]);o.useRef(null);const ie=o.useCallback(e=>{var s;const l=(s=e.target.files)==null?void 0:s[0];if(!l||!l.type.startsWith("image/"))return;A(l);const t=new FileReader;t.onload=i=>{var b;const n=(b=i.target)==null?void 0:b.result;O(n);const a=new Image;a.onload=()=>{le.current=a,E(a.width),L(a.height),R(a.width),F(a.height);const g=u.current;if(g){g.width=a.width,g.height=a.height;const p=g.getContext("2d");p&&(p.drawImage(a,0,0),D())}},a.src=n},t.readAsDataURL(l)},[]),D=()=>{const e=u.current;if(!e)return;const l=document.createElement("canvas");l.width=e.width,l.height=e.height;const t=l.getContext("2d");t&&(t.drawImage(e,0,0),x.current=[...x.current,l],x.current.length>20&&x.current.shift())},f=()=>{const e=u.current;if(!e||x.current.length===0)return;const l=x.current[x.current.length-1],t=e.getContext("2d");t&&(t.clearRect(0,0,e.width,e.height),t.drawImage(l,0,0))},ne=()=>{x.current.length>1&&(x.current.pop(),f())};o.useEffect(()=>{if(c==="crop"&&!h){const e=u.current;if(e){const l=Math.min(e.width,e.height)*.1;y({x:l,y:l,width:e.width-l*2,height:e.height-l*2})}}else c!=="crop"&&h&&(y(null),f())},[c]);const X=e=>{const l=u.current;if(!l)return{x:0,y:0};const t=l.getBoundingClientRect(),s=l.width/t.width,i=l.height/t.height;return{x:(e.clientX-t.left)*s,y:(e.clientY-t.top)*i}},Y=(e,l)=>{const{x:s,y:i,width:n,height:a}=l;return Math.abs(e.x-s)<8&&Math.abs(e.y-i)<8?"tl":Math.abs(e.x-(s+n))<8&&Math.abs(e.y-i)<8?"tr":Math.abs(e.x-s)<8&&Math.abs(e.y-(i+a))<8?"bl":Math.abs(e.x-(s+n))<8&&Math.abs(e.y-(i+a))<8?"br":Math.abs(e.x-s)<8&&e.y>i&&e.y<i+a?"left":Math.abs(e.x-(s+n))<8&&e.y>i&&e.y<i+a?"right":Math.abs(e.y-i)<8&&e.x>s&&e.x<s+n?"top":Math.abs(e.y-(i+a))<8&&e.x>s&&e.x<s+n?"bottom":e.x>s&&e.x<s+n&&e.y>i&&e.y<i+a?"move":null},K=(e,l)=>{const{x:t,y:s,width:i,height:n}=l;if(e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.clearRect(t,s,i,n),x.current.length>0){const g=x.current[x.current.length-1];e.drawImage(g,t,s,i,n,t,s,i,n)}e.strokeStyle="#00FF00",e.lineWidth=2,e.strokeRect(t,s,i,n),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=1,e.beginPath(),e.moveTo(t+i/3,s),e.lineTo(t+i/3,s+n),e.moveTo(t+i*2/3,s),e.lineTo(t+i*2/3,s+n),e.moveTo(t,s+n/3),e.lineTo(t+i,s+n/3),e.moveTo(t,s+n*2/3),e.lineTo(t+i,s+n*2/3),e.stroke();const a=6;e.fillStyle="#00FF00",e.strokeStyle="#FFFFFF",e.lineWidth=1,[{x:t,y:s},{x:t+i,y:s},{x:t,y:s+n},{x:t+i,y:s+n},{x:t+i/2,y:s},{x:t+i,y:s+n/2},{x:t+i/2,y:s+n},{x:t,y:s+n/2}].forEach(g=>{e.fillRect(g.x-a/2,g.y-a/2,a,a),e.strokeRect(g.x-a/2,g.y-a/2,a,a)})},oe=e=>{const l=X(e);if(c==="crop")if(h){const t=Y(l,h);t?(k(!0),v(t),M(l),S({...h})):(y({x:l.x,y:l.y,width:0,height:0}),k(!0),v("br"),M(l),S({x:l.x,y:l.y,width:0,height:0}))}else y({x:l.x,y:l.y,width:0,height:0}),k(!0),v("br"),M(l),S({x:l.x,y:l.y,width:0,height:0});else(c==="draw"||c==="mosaic")&&(J(!0),H(l))},de=e=>{const l=u.current;if(!l)return;const t=l.getContext("2d");if(!t)return;const s=X(e);if(c==="crop"){if(B&&W&&d&&G){const i=s.x-W.x,n=s.y-W.y;let a={...d};switch(G){case"tl":a.x=d.x+i,a.y=d.y+n,a.width=d.width-i,a.height=d.height-n;break;case"tr":a.y=d.y+n,a.width=d.width+i,a.height=d.height-n;break;case"bl":a.x=d.x+i,a.width=d.width-i,a.height=d.height+n;break;case"br":a.width=d.width+i,a.height=d.height+n;break;case"top":a.y=d.y+n,a.height=d.height-n;break;case"bottom":a.height=d.height+n;break;case"left":a.x=d.x+i,a.width=d.width-i;break;case"right":a.width=d.width+i;break;case"move":a.x=d.x+i,a.y=d.y+n;break}a.width<0&&(a.x+=a.width,a.width=-a.width),a.height<0&&(a.y+=a.height,a.height=-a.height),a.x=Math.max(0,Math.min(a.x,l.width)),a.y=Math.max(0,Math.min(a.y,l.height)),a.width=Math.min(a.width,l.width-a.x),a.height=Math.min(a.height,l.height-a.y),y(a),f(),K(t,a)}else if(h){f(),K(t,h);const i=Y(s,h);if(i){const n={tl:"nw-resize",tr:"ne-resize",bl:"sw-resize",br:"se-resize",top:"n-resize",bottom:"s-resize",left:"w-resize",right:"e-resize",move:"move"};l.style.cursor=n[i]||"default"}else l.style.cursor="crosshair"}}else if(q&&m){if(c==="mosaic")ce(t,s);else if(c==="draw"){if(w==="pen")t.strokeStyle=I,t.lineWidth=N,t.lineCap="round",t.lineJoin="round",t.beginPath(),t.moveTo(m.x,m.y),t.lineTo(s.x,s.y),t.stroke(),H(s);else if(f(),t.strokeStyle=I,t.lineWidth=N,w==="line")t.beginPath(),t.moveTo(m.x,m.y),t.lineTo(s.x,s.y),t.stroke();else if(w==="rect")t.strokeRect(m.x,m.y,s.x-m.x,s.y-m.y);else if(w==="circle"){const i=Math.sqrt(Math.pow(s.x-m.x,2)+Math.pow(s.y-m.y,2));t.beginPath(),t.arc(m.x,m.y,i,0,2*Math.PI),t.stroke()}}}},ce=(e,l)=>{const t=T,s=Math.floor(l.x/t)*t,i=Math.floor(l.y/t)*t,a=e.getImageData(s,i,t,t).data;let b=0,g=0,p=0;const $=t*t;for(let j=0;j<a.length;j+=4)b+=a[j],g+=a[j+1],p+=a[j+2];b=Math.floor(b/$),g=Math.floor(g/$),p=Math.floor(p/$),e.fillStyle=`rgb(${b},${g},${p})`,e.fillRect(s,i,t,t)},Q=()=>{B?(k(!1),v(null),M(null),S(null)):q&&(D(),J(!1),H(null))},he=()=>{const e=u.current;if(!e||!h)return;const l=e.getContext("2d");if(!l)return;const{x:t,y:s,width:i,height:n}=h;if(i>10&&n>10){f();const a=l.getImageData(t,s,i,n);e.width=i,e.height=n,l.putImageData(a,0,0),R(Math.round(i)),F(Math.round(n)),E(Math.round(i)),L(Math.round(n)),x.current=[],D(),y(null)}},xe=()=>{y(null),k(!1),v(null),u.current&&f()},ge=()=>{const e=u.current;if(!e)return;const l=e.getContext("2d");if(!l)return;const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const s=t.getContext("2d");s&&(s.drawImage(e,0,0),e.width=C,e.height=z,l.drawImage(t,0,0,C,z),E(C),L(z),x.current=[],D())},me=e=>{R(e),_&&P>0&&F(Math.round(e*U/P))},ue=e=>{F(e),_&&U>0&&R(Math.round(e*P/U))},be=()=>{const e=u.current;e&&e.toBlob(l=>{if(!l)return;const t=URL.createObjectURL(l),s=document.createElement("a");s.href=t,s.download=`edited-${Date.now()}.png`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)})};return r.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[r.jsxs("div",{className:"flex w-full max-w-7xl flex-col items-center gap-2 text-center mb-8",children:[r.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"图片快速编辑"}),r.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"支持裁剪、调整分辨率、涂鸦、马赛克等功能。"})]}),r.jsx("div",{className:"w-full max-w-7xl flex flex-col gap-8",children:V?r.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-[1fr_320px] gap-6 items-start",children:[r.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm flex flex-col gap-4",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"编辑区域"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsxs("button",{onClick:ne,disabled:x.current.length<=1,className:"flex items-center gap-1 px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed",children:[r.jsx("span",{className:"material-symbols-outlined text-base",children:"undo"}),"撤销"]}),r.jsxs("button",{onClick:()=>{O(""),A(null),x.current=[]},className:"flex items-center gap-1 px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800",children:[r.jsx("span",{className:"material-symbols-outlined text-base",children:"refresh"}),"更换图片"]})]})]}),r.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-200 dark:border-gray-700 p-4 overflow-auto relative",children:[r.jsx("canvas",{ref:u,onMouseDown:oe,onMouseMove:de,onMouseUp:Q,onMouseLeave:Q,className:"max-w-full max-h-[600px] cursor-crosshair",style:{cursor:c==="select"?"default":c==="crop"?"crosshair":c==="mosaic"?"cell":"crosshair"}}),h&&c==="crop"&&r.jsxs("div",{className:"absolute top-6 left-1/2 -translate-x-1/2 bg-black/80 text-white px-4 py-2 rounded-lg text-sm font-mono",children:[Math.round(h.width)," × ",Math.round(h.height)," px"]}),h&&c==="crop"&&r.jsxs("div",{className:"absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2",children:[r.jsxs("button",{onClick:he,className:"flex items-center gap-1 px-4 py-2 rounded-lg bg-green-500 text-white font-medium hover:bg-green-600 shadow-lg",children:[r.jsx("span",{className:"material-symbols-outlined text-base",children:"check"}),"确认裁剪"]}),r.jsxs("button",{onClick:xe,className:"flex items-center gap-1 px-4 py-2 rounded-lg bg-red-500 text-white font-medium hover:bg-red-600 shadow-lg",children:[r.jsx("span",{className:"material-symbols-outlined text-base",children:"close"}),"取消"]})]})]})]}),r.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm",children:r.jsxs("div",{className:"flex flex-col gap-6 min-h-[680px]",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white mb-3",children:"工具"}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"select",icon:"touch_app",label:"选择"},{id:"crop",icon:"crop",label:"裁剪"},{id:"draw",icon:"brush",label:"涂鸦"},{id:"mosaic",icon:"grid_on",label:"马赛克"}].map(e=>r.jsxs("button",{onClick:()=>Z(e.id),className:`flex flex-col items-center gap-1 p-3 rounded-lg border transition-all ${c===e.id?"border-primary bg-primary/10 text-primary":"border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200 hover:border-primary/50"}`,children:[r.jsx("span",{className:"material-symbols-outlined text-2xl",children:e.icon}),r.jsx("span",{className:"text-xs font-medium",children:e.label})]},e.id))})]}),c==="crop"&&r.jsxs("div",{className:"space-y-3",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"裁剪说明"}),r.jsxs("div",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-2",children:[r.jsx("p",{children:"• 在画布上拖拽创建裁剪框"}),r.jsx("p",{children:"• 拖拽边框和角落调整大小"}),r.jsx("p",{children:"• 拖拽内部移动裁剪框"}),r.jsx("p",{children:"• 点击确认按钮完成裁剪"})]}),h&&r.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:r.jsxs("p",{className:"text-sm font-medium text-blue-900 dark:text-blue-300",children:["当前选区: ",Math.round(h.width)," × ",Math.round(h.height)," px"]})})]}),c==="draw"&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"绘图模式"}),r.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[{id:"pen",icon:"edit",label:"画笔"},{id:"line",icon:"show_chart",label:"直线"},{id:"rect",icon:"crop_square",label:"矩形"},{id:"circle",icon:"circle",label:"圆形"}].map(e=>r.jsxs("button",{onClick:()=>ee(e.id),className:`flex items-center gap-2 p-2 rounded-lg border text-xs transition-all ${w===e.id?"border-primary bg-primary/10 text-primary":"border-gray-300 dark:border-gray-700 text-gray-700 dark:text-gray-200"}`,children:[r.jsx("span",{className:"material-symbols-outlined text-base",children:e.icon}),e.label]},e.id))}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:"颜色"}),r.jsx("input",{type:"color",value:I,onChange:e=>te(e.target.value),className:"w-full h-8 rounded cursor-pointer"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:["线条粗细: ",N,"px"]}),r.jsx("input",{type:"range",min:"1",max:"20",value:N,onChange:e=>re(Number(e.target.value)),className:"w-full"})]})]})]}),c==="mosaic"&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"马赛克设置"}),r.jsxs("div",{children:[r.jsxs("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 block",children:["马赛克大小: ",T,"px"]}),r.jsx("input",{type:"range",min:"5",max:"50",value:T,onChange:e=>ae(Number(e.target.value)),className:"w-full"})]})]}),r.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-3",children:"修改分辨率"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 w-12",children:"宽度"}),r.jsx("input",{type:"number",value:C,onChange:e=>me(Number(e.target.value)),className:"flex-1 px-2 py-1 rounded border border-gray-300 dark:border-gray-700 bg-transparent text-sm"}),r.jsx("span",{className:"text-xs text-gray-500",children:"px"})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 w-12",children:"高度"}),r.jsx("input",{type:"number",value:z,onChange:e=>ue(Number(e.target.value)),className:"flex-1 px-2 py-1 rounded border border-gray-300 dark:border-gray-700 bg-transparent text-sm"}),r.jsx("span",{className:"text-xs text-gray-500",children:"px"})]}),r.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-gray-300",children:[r.jsx("input",{type:"checkbox",checked:_,onChange:e=>se(e.target.checked),className:"rounded"}),"保持宽高比"]}),r.jsx("button",{onClick:ge,className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800",children:"应用分辨率"})]})]}),r.jsxs("button",{onClick:be,style:{backgroundColor:"#607AFB"},className:"flex items-center justify-center gap-2 w-full px-4 py-3 rounded-lg text-sm font-semibold text-white shadow hover:opacity-90",children:[r.jsx("span",{className:"material-symbols-outlined text-base",children:"download"}),"导出图片"]})]})})]}):r.jsx("div",{className:"w-full rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark shadow-sm",children:r.jsxs("label",{className:"flex flex-col items-center gap-6 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-700 p-8 sm:p-14 text-center cursor-pointer hover:border-primary dark:hover:border-primary transition-colors m-6",children:[r.jsx("span",{className:"material-symbols-outlined text-5xl text-gray-400 dark:text-gray-500",children:"upload_file"}),r.jsxs("div",{className:"flex flex-col items-center gap-2",children:[r.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"拖拽图片至此或点击选择"}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"支持 JPG, PNG, GIF 等格式"})]}),r.jsx("span",{className:"flex h-10 min-w-[84px] cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-gray-100 dark:bg-white/10 px-4 text-sm font-bold text-gray-800 dark:text-white transition-colors hover:bg-gray-200 dark:hover:bg-white/20",children:"选择图片"}),r.jsx("input",{type:"file",accept:"image/*",onChange:ie,className:"hidden"})]})})})]})};export{ke as default};
