import{r as l,j as e}from"./index-B3CJtaT8.js";import"./react-vendor-DS08_OVb.js";import"./pdf-vendor-B1Z1FYJ2.js";let C=!1;const z=async()=>{if(!(C||typeof window>"u")){if(window.DataGridXL){C=!0;return}return new Promise((r,i)=>{const a=document.createElement("script");a.src="./libs/datagridxl/datagridxl2.js",a.async=!0,a.onload=()=>{C=!0,r()},a.onerror=()=>{i(new Error("DataGridXL 加载失败"))},document.head.appendChild(a),setTimeout(()=>{C||i(new Error("DataGridXL 加载超时"))},1e4)})}};function oe(r,i){let a;return(...j)=>{a&&clearTimeout(a),a=setTimeout(()=>r(...j),i)}}const I=(r,i)=>Array.from({length:r},()=>Array.from({length:i},()=>"")),O=(r,i,a)=>Math.max(i,Math.min(a,r)),U=(r,i,a)=>Array.from({length:i},(j,m)=>Array.from({length:a},(k,g)=>{var v;return((v=r[m])==null?void 0:v[g])??""})),_=r=>r.replace(/\r\n/g,`
`).replace(/\r/g,`
`),le=r=>r.replace(/\|/g,"\\|").replace(/\n/g,"<br>"),ce=r=>r.replace(/\\/g,"\\textbackslash{}").replace(/([{}_$&#%])/g,"\\$1").replace(/\^/g,"\\^{}").replace(/~/g,"\\~{}").replace(/\n/g," "),xe=()=>{const[r,i]=l.useState(4),[a,j]=l.useState(4),[m,k]=l.useState(()=>I(4,4)),[g,v]=l.useState("markdown"),[y,P]=l.useState(!0),[$,N]=l.useState("loading"),[W,G]=l.useState(0),[R,S]=l.useState(!1),[B,L]=l.useState(!1),h=l.useRef(null),b=l.useRef(null),A=l.useRef(m);l.useEffect(()=>{z().catch(t=>{console.error("DataGridXL 加载失败:",t),N("error")})},[]),l.useEffect(()=>{A.current=m},[m]),l.useEffect(()=>{let t=!1;return(async()=>{if(!h.current&&(await new Promise(u=>setTimeout(u,100)),!h.current))return;const n=h.current;let d=0;for(;(n.offsetWidth===0||n.offsetHeight===0)&&d<10;)await new Promise(u=>setTimeout(u,50)),d++;N("loading");try{await z()}catch{t||N("error");return}if(t||!h.current||!window.DataGridXL)return;n.id||(n.id="dgxl-table-grid");const o=new window.DataGridXL(n.id,{data:A.current.map(u=>[...u]),colHeaderLabelType:"letters",rowHeaderLabelType:"numbers",allowInsertRows:!1,allowDeleteRows:!1,allowMoveRows:!1,allowInsertCols:!1,allowDeleteCols:!1,allowMoveCols:!1,fillCellsDirection:"xy",rowHeight:38});b.current=o,N("ready");const x=u=>{if(o.getData&&typeof o.getData=="function")try{const w=o.getData();if(Array.isArray(w)){k(w.map(p=>Array.isArray(p)?p.map(f=>_(f==null?"":String(f))):[]));return}}catch{}if(!u)return;const{rowIds:re=[],colIds:ae=[],values:E=[]}=u;k(w=>{const p=w.map(f=>[...f]);return re.forEach((f,X)=>{const M=f-1;ae.forEach((se,F)=>{var H;const ne=se-1;p[M]&&typeof((H=E[X])==null?void 0:H[F])<"u"&&(p[M][ne]=_(String(E[X][F]??"")))})}),p})},c=oe(x,100);o.events.on("cellvaluechange",c),o.events.on("change",c),o.events.on("afterchange",c),o.events.on("$setcellvaluesbatch",c),o.events.on("$fillcells",c),o.events.on("$clearcells",c),o.events.on("documentchange",c),o.events.on("ready",()=>{x()}),setTimeout(()=>{!t&&b.current&&x()},200)})(),()=>{var n;t=!0,(n=b.current)!=null&&n.destroy&&b.current.destroy(),b.current=null}},[W]);const D=(t,s,n)=>{i(s),j(n),k(t),G(d=>d+1)},V=t=>{const s=O(t,1,20);s!==r&&D(U(m,s,a),s,a)},q=t=>{const s=O(t,1,12);s!==a&&D(U(m,r,s),r,s)},J=()=>{D(I(r,a),r,a)},K=()=>{const t=m.map(c=>c.map(u=>le(u.trim())));if(!y)return t.map(c=>`| ${c.join(" | ")} |`).join(`
`);const s=t[0]??Array.from({length:a},()=>""),n=t.slice(1),d=`| ${s.join(" | ")} |`,o=`| ${s.map(()=>"---").join(" | ")} |`,x=n.map(c=>`| ${c.join(" | ")} |`);return[d,o,...x].join(`
`)},Q=()=>{const t=Array.from({length:a},()=>"l").join(""),s=m.map((n,d)=>{const o=n.map(x=>ce(x.trim())).join(" & ");return y&&d===0?`${o} \\\\n\\hline`:`${o} \\\\`}).join(`
`);return["\\begin{tabular}{|"+t.split("").join("|")+"|}","\\hline",s,"\\hline","\\end{tabular}"].join(`
`)},Y=()=>`
<table style="border-collapse:collapse;width:100%;font-family:Arial, sans-serif;font-size:13px;">
    ${m.map((s,n)=>`<tr>${s.map(o=>{const x=y&&n===0?"th":"td",c=o.replace(/\n/g,"<br>");return`<${x} style="border:1px solid #ccc;padding:6px;">${c||"&nbsp;"}</${x}>`}).join("")}</tr>`).join("")}
</table>`.trim(),T=l.useMemo(()=>{switch(g){case"latex":return Q();case"word":return Y();default:return K()}},[g,m,y,r,a]),Z=()=>{const t=g==="markdown"?"md":g==="latex"?"tex":"doc",s=new Blob([T],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(s),d=document.createElement("a");d.href=n,d.download=`table-convert.${t}`,d.click(),URL.revokeObjectURL(n)},ee=async()=>{try{await navigator.clipboard.writeText(T),S(!0),L(!1),window.setTimeout(()=>{L(!0)},1700),window.setTimeout(()=>{S(!1),L(!1)},2e3)}catch(t){console.error("Copy failed",t)}},te=()=>G(t=>t+1);return e.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex w-full max-w-7xl flex-col items-center gap-2 text-center mb-8",children:[e.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"表格格式转换"}),e.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"基于 DataGridXL 的可编辑表格，实时导出 Markdown / LaTeX / Word。"})]}),e.jsxs("div",{className:"w-full max-w-7xl flex flex-col gap-6",children:[R&&e.jsx("div",{className:`fixed top-8 left-1/2 -translate-x-1/2 z-50 ${B?"animate-fade-out-up":"animate-fade-in-down"}`,children:e.jsxs("div",{className:"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"check_circle"}),e.jsx("span",{className:"font-medium",children:"已复制到剪贴板!"})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:["行数",e.jsx("input",{type:"number",min:1,max:20,value:r,onChange:t=>V(Number(t.target.value)),className:"w-20 rounded-md border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-1 text-sm"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:["列数",e.jsx("input",{type:"number",min:1,max:12,value:a,onChange:t=>q(Number(t.target.value)),className:"w-20 rounded-md border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-1 text-sm"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:t=>P(t.target.checked),className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),"第一行作为表头"]}),e.jsx("button",{onClick:J,className:"ml-auto text-sm font-medium text-primary hover:underline",children:"清空表格"})]}),e.jsxs("div",{className:"relative rounded-lg border border-dashed border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30 min-h-[360px]",children:[e.jsx("div",{ref:h,className:"h-[360px] w-full overflow-hidden rounded-lg"}),$!=="ready"&&e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-3 rounded-lg bg-white/80 dark:bg-gray-900/80 text-sm text-gray-600 dark:text-gray-300",children:$==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"正在加载 DataGridXL..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"DataGridXL 加载失败，请检查网络后重试。"}),e.jsx("button",{onClick:te,className:"text-primary font-semibold",children:"重新加载"})]})})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center rounded-lg bg-gray-100 dark:bg-white/5 p-1.5",children:["markdown","latex","word"].map(t=>e.jsx("button",{onClick:()=>v(t),className:`flex-1 rounded-md px-3 py-2 text-sm font-semibold capitalize transition-all ${g===t?"bg-white text-gray-900 shadow-sm dark:bg-gray-700 dark:text-gray-50":"text-gray-500 dark:text-gray-400"}`,children:t},t))}),e.jsx("textarea",{value:T,readOnly:!0,className:"min-h-[320px] flex-1 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 px-4 py-3 text-sm font-mono text-gray-800 dark:text-gray-100"}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["支持直接复制或下载为 ",g==="markdown"?".md":g==="latex"?".tex":".doc"," 文件。"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:ee,className:"flex items-center gap-1 rounded-lg border border-gray-300 dark:border-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"content_copy"}),e.jsx("span",{children:R?"已复制!":"复制"})]}),e.jsxs("button",{onClick:Z,className:"flex items-center gap-1 rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow hover:opacity-90",style:{backgroundColor:"#607AFB"},children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"download"}),"下载"]})]})]})]})]})]})]})};export{xe as default};
