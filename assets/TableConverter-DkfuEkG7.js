import{r as l,j as e}from"./index-DBhBG4gC.js";import"./react-vendor-DS08_OVb.js";import"./pdf-vendor-1qLBXhNR.js";let D=!1;const oe=async()=>{if(!(D||typeof window>"u")){if(window.DataGridXL){D=!0;return}return new Promise((a,i)=>{const r=document.createElement("script");r.src="./libs/datagridxl/datagridxl2.js",r.async=!0,r.onload=()=>{D=!0,a()},r.onerror=()=>{i(new Error("DataGridXL 加载失败"))},document.head.appendChild(r),setTimeout(()=>{D||i(new Error("DataGridXL 加载超时"))},1e4)})}};function le(a,i){let r;return(...k)=>{r&&clearTimeout(r),r=setTimeout(()=>a(...k),i)}}const ie=()=>new Promise((a,i)=>{if(window.DataGridXL){a();return}const r=document.createElement("script");r.src="/libs/datagridxl/datagridxl2.js",r.async=!0,r.onload=()=>a(),r.onerror=()=>i(new Error("load_failed")),document.head.appendChild(r)}),z=(a,i)=>Array.from({length:a},()=>Array.from({length:i},()=>"")),O=(a,i,r)=>Math.max(i,Math.min(r,a)),_=(a,i,r)=>Array.from({length:i},(k,c)=>Array.from({length:r},(v,u)=>{var N;return((N=a[c])==null?void 0:N[u])??""})),P=a=>a.replace(/\r\n/g,`
`).replace(/\r/g,`
`),de=a=>a.replace(/\|/g,"\\|").replace(/\n/g,"<br>"),ce=a=>a.replace(/\\/g,"\\textbackslash{}").replace(/([{}_$&#%])/g,"\\$1").replace(/\^/g,"\\^{}").replace(/~/g,"\\~{}").replace(/\n/g," "),ge=()=>{const[a,i]=l.useState(4),[r,k]=l.useState(4),[c,v]=l.useState(()=>z(4,4)),[u,N]=l.useState("markdown"),[h,U]=l.useState(!0),[$,L]=l.useState("loading"),[W,R]=l.useState(0),[S,X]=l.useState(!1),[B,C]=l.useState(!1),b=l.useRef(null),w=l.useRef(null),E=l.useRef(c);l.useEffect(()=>{oe().catch(t=>{console.error("DataGridXL 加载失败:",t),L("error")})},[]),l.useEffect(()=>{E.current=c},[c]),l.useEffect(()=>{let t=!1;const o=()=>new Promise((s,x)=>{if(window.DataGridXL){s();return}const n=Date.now(),d=window.setInterval(()=>{window.DataGridXL?(window.clearInterval(d),s()):Date.now()-n>8e3&&(window.clearInterval(d),x(new Error("timeout")))},120)});return(async()=>{if(!b.current&&(await new Promise(p=>setTimeout(p,100)),!b.current))return;const s=b.current;let x=0;for(;(s.offsetWidth===0||s.offsetHeight===0)&&x<10;)await new Promise(p=>setTimeout(p,50)),x++;L("loading");try{await ie(),await o()}catch{t||L("error");return}if(t||!b.current||!window.DataGridXL)return;s.id||(s.id="dgxl-table-grid");const n=new window.DataGridXL(s.id,{data:E.current.map(p=>[...p]),colHeaderLabelType:"letters",rowHeaderLabelType:"numbers",allowInsertRows:!1,allowDeleteRows:!1,allowMoveRows:!1,allowInsertCols:!1,allowDeleteCols:!1,allowMoveCols:!1,fillCellsDirection:"xy",rowHeight:38});w.current=n,L("ready");const d=p=>{if(n.getData&&typeof n.getData=="function")try{const j=n.getData();if(Array.isArray(j)){v(j.map(f=>Array.isArray(f)?f.map(y=>P(y==null?"":String(y))):[]));return}}catch{}if(!p)return;const{rowIds:re=[],colIds:ae=[],values:A=[]}=p;v(j=>{const f=j.map(y=>[...y]);return re.forEach((y,F)=>{const I=y-1;ae.forEach((se,M)=>{var H;const ne=se-1;f[I]&&typeof((H=A[F])==null?void 0:H[M])<"u"&&(f[I][ne]=P(String(A[F][M]??"")))})}),f})},g=le(d,100);n.events.on("cellvaluechange",g),n.events.on("change",g),n.events.on("afterchange",g),n.events.on("$setcellvaluesbatch",g),n.events.on("$fillcells",g),n.events.on("$clearcells",g),n.events.on("documentchange",g),n.events.on("ready",()=>{d()}),setTimeout(()=>{!t&&w.current&&d()},200)})(),()=>{var s;t=!0,(s=w.current)!=null&&s.destroy&&w.current.destroy(),w.current=null}},[W]);const G=(t,o,m)=>{i(o),k(m),v(t),R(s=>s+1)},V=t=>{const o=O(t,1,20);o!==a&&G(_(c,o,r),o,r)},q=t=>{const o=O(t,1,12);o!==r&&G(_(c,a,o),a,o)},J=()=>{G(z(a,r),a,r)},K=()=>{const t=c.map(d=>d.map(g=>de(g.trim())));if(!h)return t.map(d=>`| ${d.join(" | ")} |`).join(`
`);const o=t[0]??Array.from({length:r},()=>""),m=t.slice(1),s=`| ${o.join(" | ")} |`,x=`| ${o.map(()=>"---").join(" | ")} |`,n=m.map(d=>`| ${d.join(" | ")} |`);return[s,x,...n].join(`
`)},Q=()=>{const t=Array.from({length:r},()=>"l").join(""),o=c.map((m,s)=>{const x=m.map(n=>ce(n.trim())).join(" & ");return h&&s===0?`${x} \\\\n\\hline`:`${x} \\\\`}).join(`
`);return["\\begin{tabular}{|"+t.split("").join("|")+"|}","\\hline",o,"\\hline","\\end{tabular}"].join(`
`)},Y=()=>`
<table style="border-collapse:collapse;width:100%;font-family:Arial, sans-serif;font-size:13px;">
    ${c.map((o,m)=>`<tr>${o.map(x=>{const n=h&&m===0?"th":"td",d=x.replace(/\n/g,"<br>");return`<${n} style="border:1px solid #ccc;padding:6px;">${d||"&nbsp;"}</${n}>`}).join("")}</tr>`).join("")}
</table>`.trim(),T=l.useMemo(()=>{switch(u){case"latex":return Q();case"word":return Y();default:return K()}},[u,c,h,a,r]),Z=()=>{const t=u==="markdown"?"md":u==="latex"?"tex":"doc",o=new Blob([T],{type:"text/plain;charset=utf-8"}),m=URL.createObjectURL(o),s=document.createElement("a");s.href=m,s.download=`table-convert.${t}`,s.click(),URL.revokeObjectURL(m)},ee=async()=>{try{await navigator.clipboard.writeText(T),X(!0),C(!1),window.setTimeout(()=>{C(!0)},1700),window.setTimeout(()=>{X(!1),C(!1)},2e3)}catch(t){console.error("Copy failed",t)}},te=()=>R(t=>t+1);return e.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex w-full max-w-7xl flex-col items-center gap-2 text-center mb-8",children:[e.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"表格格式转换"}),e.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"基于 DataGridXL 的可编辑表格，实时导出 Markdown / LaTeX / Word。"})]}),e.jsxs("div",{className:"w-full max-w-7xl flex flex-col gap-6",children:[S&&e.jsx("div",{className:`fixed top-8 left-1/2 -translate-x-1/2 z-50 ${B?"animate-fade-out-up":"animate-fade-in-down"}`,children:e.jsxs("div",{className:"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"check_circle"}),e.jsx("span",{className:"font-medium",children:"已复制到剪贴板!"})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:["行数",e.jsx("input",{type:"number",min:1,max:20,value:a,onChange:t=>V(Number(t.target.value)),className:"w-20 rounded-md border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-1 text-sm"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:["列数",e.jsx("input",{type:"number",min:1,max:12,value:r,onChange:t=>q(Number(t.target.value)),className:"w-20 rounded-md border border-gray-300 dark:border-gray-700 bg-transparent px-3 py-1 text-sm"})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:h,onChange:t=>U(t.target.checked),className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"}),"第一行作为表头"]}),e.jsx("button",{onClick:J,className:"ml-auto text-sm font-medium text-primary hover:underline",children:"清空表格"})]}),e.jsxs("div",{className:"relative rounded-lg border border-dashed border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30 min-h-[360px]",children:[e.jsx("div",{ref:b,className:"h-[360px] w-full overflow-hidden rounded-lg"}),$!=="ready"&&e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-3 rounded-lg bg-white/80 dark:bg-gray-900/80 text-sm text-gray-600 dark:text-gray-300",children:$==="loading"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"正在加载 DataGridXL..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"DataGridXL 加载失败，请检查网络后重试。"}),e.jsx("button",{onClick:te,className:"text-primary font-semibold",children:"重新加载"})]})})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm flex flex-col gap-4",children:[e.jsx("div",{className:"flex items-center rounded-lg bg-gray-100 dark:bg-white/5 p-1.5",children:["markdown","latex","word"].map(t=>e.jsx("button",{onClick:()=>N(t),className:`flex-1 rounded-md px-3 py-2 text-sm font-semibold capitalize transition-all ${u===t?"bg-white text-gray-900 shadow-sm dark:bg-gray-700 dark:text-gray-50":"text-gray-500 dark:text-gray-400"}`,children:t},t))}),e.jsx("textarea",{value:T,readOnly:!0,className:"min-h-[320px] flex-1 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 px-4 py-3 text-sm font-mono text-gray-800 dark:text-gray-100"}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["支持直接复制或下载为 ",u==="markdown"?".md":u==="latex"?".tex":".doc"," 文件。"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:ee,className:"flex items-center gap-1 rounded-lg border border-gray-300 dark:border-gray-700 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800",children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"content_copy"}),e.jsx("span",{children:S?"已复制!":"复制"})]}),e.jsxs("button",{onClick:Z,className:"flex items-center gap-1 rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow hover:opacity-90",style:{backgroundColor:"#607AFB"},children:[e.jsx("span",{className:"material-symbols-outlined text-base",children:"download"}),"下载"]})]})]})]})]})]})]})};export{ge as default};
