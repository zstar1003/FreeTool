import{r as l,j as e}from"./index-CqFSKw8P.js";import"./react-vendor-DS08_OVb.js";import"./pdf-vendor-B1Z1FYJ2.js";const G=[{id:"square",name:"正方形",ratio:1/1},{id:"portrait",name:"竖版",ratio:3/4},{id:"post",name:"横版",ratio:4/3},{id:"story",name:"故事",ratio:9/16},{id:"wide",name:"宽屏",ratio:16/9}],ie=(t,x)=>{const d=[];if(t===1)return{id:"single",name:"单图",slots:1,layout:[{x:0,y:0,width:1,height:1}]};if(t===2)return x==="horizontal"?{id:"horizontal-2",name:"水平 2 行",slots:2,layout:[{x:0,y:0,width:1,height:.5},{x:0,y:.5,width:1,height:.5}]}:{id:"vertical-2",name:"垂直 2 列",slots:2,layout:[{x:0,y:0,width:.5,height:1},{x:.5,y:0,width:.5,height:1}]};if(t===3)return x==="horizontal"?{id:"horizontal-3",name:"水平 3 行",slots:3,layout:[{x:0,y:0,width:1,height:1/3},{x:0,y:1/3,width:1,height:1/3},{x:0,y:2/3,width:1,height:1/3}]}:{id:"vertical-3",name:"垂直 3 列",slots:3,layout:[{x:0,y:0,width:1/3,height:1},{x:1/3,y:0,width:1/3,height:1},{x:2/3,y:0,width:1/3,height:1}]};if(t===4)return{id:"grid-2x2",name:"2x2 网格",slots:4,layout:[{x:0,y:0,width:.5,height:.5},{x:.5,y:0,width:.5,height:.5},{x:0,y:.5,width:.5,height:.5},{x:.5,y:.5,width:.5,height:.5}]};if(t>=5&&t<=6){if(x==="horizontal")for(let s=0;s<3;s++)for(let i=0;i<2;i++)d.length<t&&d.push({x:i*.5,y:s*(1/3),width:.5,height:1/3});else for(let s=0;s<2;s++)for(let i=0;i<3;i++)d.length<t&&d.push({x:i*(1/3),y:s*.5,width:1/3,height:.5});return{id:`grid-${t}`,name:`${t}图网格`,slots:t,layout:d}}if(t>=7&&t<=9){for(let s=0;s<3;s++)for(let i=0;i<3;i++)d.length<t&&d.push({x:i*(1/3),y:s*(1/3),width:1/3,height:1/3});return{id:`grid-${t}`,name:`${t}图网格`,slots:t,layout:d}}const g=Math.ceil(Math.sqrt(t));for(let s=0;s<g;s++)for(let i=0;i<g;i++)d.length<t&&d.push({x:i*(1/g),y:s*(1/g),width:1/g,height:1/g});return{id:`grid-${t}`,name:`${t}图网格`,slots:t,layout:d}},ge=()=>{const[t,x]=l.useState([]),[d,g]=l.useState("vertical"),[s,i]=l.useState("cover"),[v,X]=l.useState(G[4]),[k,Y]=l.useState(1200),[m,J]=l.useState(10),[f,K]=l.useState("#FFFFFF"),[de,M]=l.useState(!1),[j,A]=l.useState(""),[h,$]=l.useState(null),[w,S]=l.useState(null),Q=l.useRef(null),P=l.useRef(null),y=t.length>0?ie(t.length,d):null,b=v.ratio>=1?k:Math.round(k*v.ratio),p=v.ratio>=1?Math.round(k/v.ratio):k,V=l.useCallback(r=>{const L=Array.from(r.target.files||[]).filter(o=>o.type.startsWith("image/")).map(o=>({file:o,url:URL.createObjectURL(o)}));x(o=>[...o,...L])},[]),Z=l.useCallback(r=>{x(a=>{const n=[...a];return URL.revokeObjectURL(n[r].url),n.splice(r,1),n})},[]),ee=l.useCallback(()=>{t.forEach(r=>URL.revokeObjectURL(r.url)),x([]),A("")},[t]),re=l.useCallback(r=>{$(r)},[]),te=l.useCallback((r,a)=>{r.preventDefault(),S(a)},[]),ae=l.useCallback(()=>{if(h===null||w===null||h===w){$(null),S(null);return}x(r=>{const a=[...r],n=a[h];return a.splice(h,1),a.splice(w,0,n),a}),$(null),S(null)},[h,w]),se=l.useCallback(()=>{S(null)},[]),le=l.useCallback(async()=>{if(!(t.length===0||!y)){M(!0);try{const r=P.current;if(!r)return;r.width=b,r.height=p;const a=r.getContext("2d");if(!a)return;a.fillStyle=f,a.fillRect(0,0,b,p);const n=await Promise.all(t.slice(0,y.slots).map(o=>new Promise((R,c)=>{const u=new Image;u.onload=()=>R(u),u.onerror=c,u.src=o.url})));y.layout.forEach((o,R)=>{if(R>=n.length)return;const c=n[R],u=m/2,U=o.x*b+u,z=o.y*p+u,N=o.width*b-m,C=o.height*p-m;a.fillStyle=f,a.fillRect(U,z,N,C);const I=N/C,D=c.width/c.height;let q=0,H=0,F=c.width,E=c.height,T=U,B=z,O=N,_=C;s==="cover"?D>I?(F=c.height*I,q=(c.width-F)/2):(E=c.width/I,H=(c.height-E)/2):s==="contain"&&(D>I?(_=N/D,B=z+(C-_)/2):(O=C*D,T=U+(N-O)/2)),a.drawImage(c,q,H,F,E,T,B,O,_)});const L=r.toDataURL("image/png");A(L)}catch(r){console.error("生成拼接图失败:",r),alert("生成拼接图时出错，请重试")}finally{M(!1)}}},[t,y,b,p,m,f,s]),W=l.useCallback(()=>{if(!j)return;const r=document.createElement("a");r.download=`collage-${Date.now()}.png`,r.href=j,r.click()},[j]);return l.useEffect(()=>{t.length>0&&le()},[t,d,b,p,m,f,s]),e.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex w-full max-w-7xl flex-col items-center gap-2 text-center mb-8",children:[e.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"模板快速拼接"}),e.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"上传多张图片，选择模板自动拼接成一张图片"})]}),e.jsxs("div",{className:"w-full max-w-7xl",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800/20 shadow-sm p-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:["上传图片 (",t.length," 张)"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{ref:Q,type:"file",accept:"image/*",multiple:!0,onChange:V,className:"flex-1 text-sm text-gray-600 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:opacity-90"}),t.length>0&&e.jsx("button",{onClick:ee,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:"清除全部"})]})]}),t.length>0&&e.jsx("div",{className:"grid grid-cols-6 sm:grid-cols-8 md:grid-cols-10 gap-2",children:t.map((r,a)=>e.jsxs("div",{draggable:!0,onDragStart:()=>re(a),onDragOver:n=>te(n,a),onDragEnd:ae,onDragLeave:se,className:`relative group cursor-move ${h===a?"opacity-50":""} ${w===a&&h!==a?"ring-2 ring-primary ring-offset-2":""}`,children:[e.jsx("img",{src:r.url,alt:`图片 ${a+1}`,className:"w-full aspect-square object-cover rounded border border-gray-200 dark:border-gray-700"}),e.jsx("button",{onClick:()=>Z(a),className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs",children:"×"}),e.jsx("div",{className:"absolute bottom-0.5 left-0.5 bg-black/60 text-white text-xs px-1 py-0.5 rounded text-[10px]",children:a+1}),e.jsx("div",{className:"absolute top-0.5 left-0.5 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"material-symbols-outlined text-white text-sm drop-shadow-lg",children:"drag_indicator"})})]},a))})]})}),j?e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800/20 shadow-sm p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"拼接预览"}),e.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-lg font-medium hover:opacity-90 transition-opacity",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"download"}),"下载拼接图"]})]}),e.jsx("div",{className:"flex justify-center h-[450px]",children:e.jsx("img",{src:j,alt:"拼接预览",className:"max-w-full max-h-full object-contain rounded-lg shadow-lg border border-gray-200 dark:border-gray-700"})})]}):t.length===0&&e.jsxs("div",{className:"rounded-xl border border-dashed border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30 p-12 text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-gray-400 dark:text-gray-500 mb-4 block",children:"collections"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"请上传图片开始制作拼接图"})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[y&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-blue-700 dark:text-blue-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"info"}),e.jsx("span",{className:"text-xs font-medium",children:"当前配置"})]}),e.jsxs("span",{className:"text-xs font-medium",children:[y.name," (",y.slots,"张) · ",b," x ",p]})]})}),t.length>0&&e.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800/20 shadow-sm p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"画布比例"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:G.map(r=>e.jsxs("button",{onClick:()=>X(r),className:`flex items-center justify-between px-3 py-2 rounded-lg border-2 transition-all ${v.id===r.id?"border-primary bg-primary/5 text-primary":"border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("span",{className:"font-medium text-sm",children:r.name}),e.jsxs("span",{className:"text-xs opacity-70",children:[r.id==="square"&&"1:1",r.id==="portrait"&&"3:4",r.id==="post"&&"4:3",r.id==="story"&&"9:16",r.id==="wide"&&"16:9"]})]},r.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"图片适配"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("button",{onClick:()=>i("cover"),className:`flex items-center justify-between px-3 py-2 rounded-lg border-2 transition-all ${s==="cover"?"border-primary bg-primary/5 text-primary":"border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"crop_free"}),e.jsx("span",{className:"font-medium text-sm",children:"填充"})]}),e.jsx("span",{className:"text-xs opacity-70",children:"裁剪"})]}),e.jsxs("button",{onClick:()=>i("contain"),className:`flex items-center justify-between px-3 py-2 rounded-lg border-2 transition-all ${s==="contain"?"border-primary bg-primary/5 text-primary":"border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"fit_screen"}),e.jsx("span",{className:"font-medium text-sm",children:"适应"})]}),e.jsx("span",{className:"text-xs opacity-70",children:"完整"})]}),e.jsxs("button",{onClick:()=>i("fill"),className:`flex items-center justify-between px-3 py-2 rounded-lg border-2 transition-all ${s==="fill"?"border-primary bg-primary/5 text-primary":"border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"open_in_full"}),e.jsx("span",{className:"font-medium text-sm",children:"拉伸"})]}),e.jsx("span",{className:"text-xs opacity-70",children:"变形"})]})]})]})]})}),t.length>=2&&t.length<=3&&e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800/20 shadow-sm p-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"布局方向"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>g("vertical"),className:`flex items-center justify-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${d==="vertical"?"border-primary bg-primary/5 text-primary":"border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"view_column"}),e.jsx("span",{className:"font-medium text-sm",children:"左右"})]}),e.jsxs("button",{onClick:()=>g("horizontal"),className:`flex items-center justify-center gap-2 px-3 py-2 rounded-lg border-2 transition-all ${d==="horizontal"?"border-primary bg-primary/5 text-primary":"border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-600"}`,children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"view_agenda"}),e.jsx("span",{className:"font-medium text-sm",children:"上下"})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800/20 shadow-sm p-4",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"其他设置"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-2",children:"基准尺寸"}),e.jsxs("select",{value:k,onChange:r=>Y(Number(r.target.value)),className:"w-full px-3 py-2 text-sm border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[e.jsx("option",{value:800,children:"800px"}),e.jsx("option",{value:1200,children:"1200px"}),e.jsx("option",{value:1600,children:"1600px"}),e.jsx("option",{value:2e3,children:"2000px"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-2",children:["图片间距: ",m,"px"]}),e.jsx("input",{type:"range",min:"0",max:"50",value:m,onChange:r=>J(Number(r.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 dark:text-gray-400 mb-2",children:"背景颜色"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"color",value:f,onChange:r=>K(r.target.value),className:"h-9 w-16 rounded border border-gray-300 dark:border-gray-700 cursor-pointer"}),e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 font-mono",children:f.toUpperCase()})]})]})]})]}),j&&e.jsxs("button",{onClick:W,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-primary text-white border border-gray-300 dark:border-gray-600 rounded-lg font-semibold shadow hover:opacity-90 transition-opacity",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"download"}),e.jsx("span",{children:"保存图像"})]})]})]}),e.jsx("canvas",{ref:P,className:"hidden"})]})]})};export{ge as default};
