import{r as l,j as e}from"./index-CW6tAkc5.js";import"./react-vendor-DS08_OVb.js";import"./pdf-vendor-1qLBXhNR.js";const $=[{value:"16:9",label:"16:9 (横屏)",ratio:16/9},{value:"9:16",label:"9:16 (竖屏)",ratio:9/16},{value:"4:3",label:"4:3 (标准)",ratio:4/3},{value:"1:1",label:"1:1 (正方形)",ratio:1/1}],ee=()=>{const[j,M]=l.useState(null),[u,P]=l.useState(""),[f,D]=l.useState("16:9"),[i,V]=l.useState("color"),[w,z]=l.useState("#000000"),[I,N]=l.useState(!1),[n,C]=l.useState(""),[h,O]=l.useState(null),R=l.useRef(null),p=l.useRef(null),S=l.useRef(null),_=t=>{var a;const c=(a=t.target.files)==null?void 0:a[0];if(c&&c.type.startsWith("video/")){M(c);const x=URL.createObjectURL(c);P(x),C("")}},q=()=>{const t=p.current;t&&O({width:t.videoWidth,height:t.videoHeight})},X=async()=>{var t,c;if(!(!j||!p.current||!S.current)){N(!0);try{const a=p.current,x=S.current,m=x.getContext("2d");if(!m)throw new Error("无法获取 Canvas 上下文");const F=((t=$.find(s=>s.value===f))==null?void 0:t.ratio)||16/9,U=a.videoWidth/a.videoHeight;let o,d,T,A,b,y;a.videoWidth>=a.videoHeight?(o=1920,d=Math.round(o/F)):(d=1920,o=Math.round(d*F)),x.width=o,x.height=d,U>F?(b=o,y=Math.round(b/U),T=0,A=(d-y)/2):(y=d,b=Math.round(y*U),T=(o-b)/2,A=0);let g=null,L=null;i==="blur"&&(g=document.createElement("canvas"),g.width=o,g.height=d,L=g.getContext("2d"));const B=x.captureStream(30),r=document.createElement("video");r.src=u,r.muted=!1,await new Promise(s=>{r.onloadedmetadata=s});let v;try{const s=r.captureStream?r.captureStream():(c=r.mozCaptureStream)==null?void 0:c.call(r);if(s){const E=s.getAudioTracks(),J=B.getVideoTracks();v=new MediaStream([...J,...E])}else v=B,console.warn("无法获取音频流，输出视频将没有声音")}catch(s){console.warn("获取音频失败:",s),v=B}const k=new MediaRecorder(v,{mimeType:"video/webm;codecs=vp9",videoBitsPerSecond:5e6}),W=[];k.ondataavailable=s=>{s.data.size>0&&W.push(s.data)},k.onstop=()=>{const s=new Blob(W,{type:"video/webm"}),E=URL.createObjectURL(s);C(E),N(!1),r.pause(),r.src=""},k.start(),a.currentTime=0,r.currentTime=0,await Promise.all([a.play(),r.play()]);const H=()=>{if(a.paused||a.ended){k.stop(),r.pause();return}i==="blur"&&L&&g?(L.drawImage(a,0,0,o,d),m.filter="blur(20px)",m.drawImage(g,0,0),m.filter="none"):(m.fillStyle=w,m.fillRect(0,0,o,d)),m.drawImage(a,T,A,b,y),requestAnimationFrame(H)};H()}catch(a){console.error("处理视频失败:",a),alert("处理视频时出错，请重试"),N(!1)}}},Y=()=>{if(n){const t=document.createElement("a");t.href=n,t.download=`converted-${f.replace(":","x")}.webm`,t.click()}},G=()=>{u&&URL.revokeObjectURL(u),n&&URL.revokeObjectURL(n),M(null),P(""),C(""),O(null),R.current&&(R.current.value="")};return e.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex w-full max-w-7xl flex-col items-center gap-2 text-center mb-8",children:[e.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"视频比例转换"}),e.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"将视频转换为标准比例，空白区域可用颜色或模糊背景填充"})]}),e.jsxs("div",{className:"w-full max-w-7xl flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"选择视频文件"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{ref:R,type:"file",accept:"video/*",onChange:_,className:"flex-1 text-sm text-gray-600 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:opacity-90",style:{"--file-bg":"#607AFB"}}),j&&e.jsx("button",{onClick:G,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:"清除"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"目标比例"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:$.map(t=>e.jsx("button",{onClick:()=>D(t.value),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${f===t.value?"bg-primary text-white shadow-sm":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,style:f===t.value?{backgroundColor:"#607AFB"}:{},children:t.label},t.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"填充方式"}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>V("color"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${i==="color"?"bg-primary text-white shadow-sm":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,style:i==="color"?{backgroundColor:"#607AFB"}:{},children:"纯色填充"}),e.jsx("button",{onClick:()=>V("blur"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${i==="blur"?"bg-primary text-white shadow-sm":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,style:i==="blur"?{backgroundColor:"#607AFB"}:{},children:"模糊背景"})]}),i==="color"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600 dark:text-gray-400",children:"颜色:"}),e.jsx("input",{type:"color",value:w,onChange:t=>z(t.target.value),className:"h-10 w-20 rounded border border-gray-300 dark:border-gray-700 cursor-pointer"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 font-mono",children:w.toUpperCase()})]})]})]}),j&&e.jsx("div",{className:"flex gap-3",children:e.jsx("button",{onClick:X,disabled:I,className:"flex-1 px-6 py-3 rounded-lg bg-primary text-white font-semibold shadow hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",style:{backgroundColor:"#607AFB"},children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-small"}),"处理中..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"play_arrow"}),"开始转换"]})})})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"原始视频"}),e.jsx("div",{className:"relative rounded-lg border border-dashed border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30 aspect-video flex items-center justify-center overflow-hidden",children:u?e.jsx("video",{ref:p,src:u,controls:!0,onLoadedMetadata:q,className:"max-w-full max-h-full"}):e.jsxs("div",{className:"text-center text-gray-400 dark:text-gray-500",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl mb-2",children:"videocam"}),e.jsx("p",{className:"text-sm",children:"未选择视频"})]})}),h&&e.jsxs("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:["尺寸: ",h.width," × ",h.height,"(比例: ",(h.width/h.height).toFixed(2),")"]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-background-dark p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"转换后视频"}),e.jsx("div",{className:"relative rounded-lg border border-dashed border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30 aspect-video flex items-center justify-center overflow-hidden",children:n?e.jsx("video",{src:n,controls:!0,className:"max-w-full max-h-full"}):e.jsxs("div",{className:"text-center text-gray-400 dark:text-gray-500",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl mb-2",children:"movie"}),e.jsx("p",{className:"text-sm",children:"等待转换"})]})}),n&&e.jsx("div",{className:"mt-4",children:e.jsxs("button",{onClick:Y,className:"w-full px-6 py-3 rounded-lg bg-primary text-white font-semibold shadow hover:opacity-90 flex items-center justify-center gap-2",style:{backgroundColor:"#607AFB"},children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"download"}),"下载转换后的视频"]})})]})]}),e.jsx("canvas",{ref:S,className:"hidden"})]})]})};export{ee as default};
