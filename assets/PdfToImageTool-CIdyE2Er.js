import{r as t,j as e}from"./index-CqFSKw8P.js";import{v as H,G as J,g as V}from"./pdf-vendor-B1Z1FYJ2.js";import"./react-vendor-DS08_OVb.js";const K=()=>{const[r,E]=t.useState(null),[c,y]=t.useState(!1),[b,d]=t.useState(0),[I,f]=t.useState(0),[C,P]=t.useState(0),[D,m]=t.useState(""),[l,j]=t.useState(""),[g,M]=t.useState("png"),[F,U]=t.useState("high"),[p,G]=t.useState(0),S=t.useRef(null);t.useEffect(()=>{J.workerSrc=`https://unpkg.com/pdfjs-dist@${H}/build/pdf.worker.min.mjs`},[]);const B={low:1,medium:1.5,high:2},L=t.useCallback(a=>{var o;const i=(o=a.target.files)==null?void 0:o[0];if(i){if(i.type!=="application/pdf"){m("请选择PDF文件");return}E(i),m(""),d(0),f(0),P(0),j("")}},[]),T=t.useCallback(async()=>{if(r){y(!0),m(""),d(0),f(0),j("");try{const a=await r.arrayBuffer(),i=await V({data:a}).promise,o=i.numPages;P(o);const q=B[F],v=[];let u=0,k=0;for(let s=1;s<=o;s++){f(s);const n=await i.getPage(s),x=n.getViewport({scale:q}),h=document.createElement("canvas"),R=h.getContext("2d");if(!R)throw new Error("无法创建canvas上下文");h.width=x.width,h.height=x.height,await n.render({canvasContext:R,viewport:x}).promise,v.push(h),u=Math.max(u,x.width),k+=x.height;const z=Math.round(s/o*50);d(z)}k+=p*(o-1),d(55);const N=document.createElement("canvas");N.width=u,N.height=k;const w=N.getContext("2d");if(!w)throw new Error("无法创建最终canvas上下文");w.fillStyle="#ffffff",w.fillRect(0,0,u,k);let $=0;for(let s=0;s<v.length;s++){const n=v[s],x=(u-n.width)/2;w.drawImage(n,x,$),$+=n.height+p;const h=55+Math.round((s+1)/v.length*40);d(h)}d(95);const Q=g==="png"?"image/png":"image/jpeg",W=g==="jpeg"?.92:void 0;N.toBlob(s=>{if(!s){m("图片生成失败"),y(!1);return}const n=URL.createObjectURL(s);j(n),d(100),y(!1)},Q,W)}catch(a){console.error("转换失败:",a),m(`转换失败: ${a instanceof Error?a.message:"未知错误"}`),y(!1)}}},[r,g,F,p]),O=t.useCallback(()=>{if(!l||!r)return;const a=document.createElement("a");a.href=l;const i=r.name.replace(".pdf",`_长图.${g}`);a.download=i,document.body.appendChild(a),a.click(),document.body.removeChild(a)},[l,r,g]),_=t.useCallback(()=>{l&&URL.revokeObjectURL(l),E(null),m(""),d(0),f(0),P(0),j(""),S.current&&(S.current.value="")},[l]);return e.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex w-full max-w-4xl flex-col items-center gap-2 text-center mb-8",children:[e.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"PDF 转长图"}),e.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"将PDF文件的所有页面拼接成一张长图"})]}),e.jsxs("div",{className:"w-full max-w-4xl flex flex-col gap-6",children:[e.jsx("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800/20 shadow-sm p-6",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"选择PDF文件"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{ref:S,type:"file",accept:".pdf,application/pdf",onChange:L,className:"flex-1 text-sm text-gray-600 dark:text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary file:text-white hover:file:opacity-90"}),r&&!c&&e.jsx("button",{onClick:_,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:"清除"})]})]}),r&&e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"material-symbols-outlined text-blue-600 dark:text-blue-400 text-3xl",children:"picture_as_pdf"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[(r.size/1024/1024).toFixed(2)," MB",C>0&&` · ${C} 页`]})]})]})}),r&&!l&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"图片格式"}),e.jsx("div",{className:"flex gap-2",children:["png","jpeg"].map(a=>e.jsx("button",{onClick:()=>M(a),disabled:c,className:`flex-1 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${g===a?"bg-primary text-white":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"} disabled:opacity-50`,children:a.toUpperCase()},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"图片质量"}),e.jsx("div",{className:"flex gap-2",children:[{value:"low",label:"低"},{value:"medium",label:"中"},{value:"high",label:"高"}].map(a=>e.jsx("button",{onClick:()=>U(a.value),disabled:c,className:`flex-1 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${F===a.value?"bg-primary text-white":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"} disabled:opacity-50`,children:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:["页面间距: ",p,"px"]}),e.jsx("input",{type:"range",min:"0",max:"50",step:"5",value:p,onChange:a=>G(parseInt(a.target.value)),disabled:c,className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-primary disabled:opacity-50"})]})]}),D&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-red-600 dark:text-red-400",children:"error"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:D})]})}),r&&!c&&!l&&e.jsxs("button",{onClick:T,disabled:c,className:"w-full flex items-center justify-center gap-2 px-6 py-3 bg-primary text-white border border-gray-300 dark:border-gray-600 rounded-lg font-semibold shadow hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-opacity",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"transform"}),e.jsx("span",{children:"开始转换"})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600 dark:text-gray-400",children:[e.jsx("span",{children:b<50?`正在渲染第 ${I} / ${C} 页...`:b<95?"正在拼接图片...":"正在生成图片..."}),e.jsxs("span",{children:[b,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${b}%`}})})]}),l&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[e.jsx("span",{className:"material-symbols-outlined",children:"check_circle"}),e.jsx("span",{className:"text-sm font-medium",children:"转换完成！"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:_,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:"重新选择"}),e.jsxs("button",{onClick:O,className:"flex items-center gap-2 px-4 py-2 text-sm font-medium bg-primary text-white rounded-lg hover:opacity-90",children:[e.jsx("span",{className:"material-symbols-outlined text-lg",children:"download"}),e.jsx("span",{children:"下载长图"})]})]})]}),e.jsx("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden max-h-[500px] overflow-y-auto bg-gray-100 dark:bg-gray-900",children:e.jsx("img",{src:l,alt:"PDF长图预览",className:"w-full h-auto"})})]})]})}),e.jsxs("div",{className:"rounded-xl border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-800/20 shadow-sm p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"功能说明"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary mt-0.5",children:"check_circle"}),e.jsx("p",{children:"纯前端转换，无需上传到服务器，数据安全"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary mt-0.5",children:"check_circle"}),e.jsx("p",{children:"将PDF所有页面垂直拼接成一张长图"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary mt-0.5",children:"check_circle"}),e.jsx("p",{children:"支持选择 PNG（无损）或 JPEG（压缩）格式"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-primary mt-0.5",children:"check_circle"}),e.jsx("p",{children:"可自定义图片质量和页面间距"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-yellow-500 mt-0.5",children:"info"}),e.jsxs("p",{className:"text-yellow-600 dark:text-yellow-500",children:[e.jsx("strong",{children:"提示："}),"页数较多或高质量设置可能需要较长处理时间"]})]})]})]}),!r&&e.jsx("div",{className:"rounded-xl border border-dashed border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/30 p-8",children:e.jsxs("div",{className:"flex flex-col items-center text-center gap-4",children:[e.jsx("span",{className:"material-symbols-outlined text-6xl text-gray-400 dark:text-gray-500",children:"upload_file"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-1",children:"上传您的PDF文件开始转换"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"支持任意大小的PDF文件，转换在浏览器本地完成"})]})]})})]})]})};export{K as default};
