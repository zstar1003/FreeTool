import{r,j as e}from"./index-DXtarUcJ.js";import"./react-vendor-DS08_OVb.js";import"./pdf-vendor-B1Z1FYJ2.js";const I=()=>{const[x,X]=r.useState(""),[d,g]=r.useState(null),[f,h]=r.useState(""),[T,k]=r.useState(!1),[$,y]=r.useState(!1),[N,b]=r.useState(null),[w,L]=r.useState(2),[v,p]=r.useState(new Set),m=r.useRef(null),M=(t,s=2)=>{const a=" ".repeat(s),n=/(>)(<)(\/*)/g;let l="",o=0;return t=t.replace(n,`$1
$2$3`),t.split(`
`).forEach(i=>{let c=0;i.match(/.+<\/\w[^>]*>$/)?c=0:i.match(/^<\/\w/)&&o>0?o-=1:i.match(/^<\w[^>]*[^\/]>.*$/)?c=1:c=0,l+=a.repeat(o)+i+`
`,o+=c}),l.trim()},S=r.useCallback(t=>{if(!t.trim()){g(null),h(""),b(null);return}try{const a=new DOMParser().parseFromString(t,"text/xml"),n=a.querySelector("parsererror");if(n)throw new Error(n.textContent||"XML 解析错误");g(a);const o=new XMLSerializer().serializeToString(a),i=M(o,w);h(i),b(null),p(new Set(["root"]))}catch(s){b(s instanceof Error?s.message:"XML 格式错误"),g(null),h("")}},[w]);r.useEffect(()=>(m.current&&clearTimeout(m.current),x.trim()?m.current=setTimeout(()=>{S(x)},300):(g(null),h(""),b(null)),()=>{m.current&&clearTimeout(m.current)}),[x,S]);const _=r.useCallback(()=>{f&&navigator.clipboard.writeText(f).then(()=>{k(!0),y(!1),setTimeout(()=>{y(!0)},1700),setTimeout(()=>{k(!1),y(!1)},2e3)}).catch(t=>{console.error("Failed to copy text: ",t)})},[f]),C=r.useCallback(t=>{p(s=>{const a=new Set(s);return a.has(t)?a.delete(t):a.add(t),a})},[]),z=r.useCallback(()=>{if(!d)return;const t=new Set,s=(a,n)=>{t.add(n),Array.from(a.children).forEach((l,o)=>{s(l,`${n}.${l.nodeName}[${o}]`)})};d.documentElement&&s(d.documentElement,"root"),p(t)},[d]),F=r.useCallback(()=>{p(new Set(["root"]))},[]),E=r.useCallback((t,s,a=0)=>{var c;const n=v.has(s),l=t.children.length>0,o=Array.from(t.attributes),i=t.childNodes.length===1&&t.childNodes[0].nodeType===Node.TEXT_NODE?(c=t.childNodes[0].textContent)==null?void 0:c.trim():"";return e.jsx("div",{className:"py-0.5",children:e.jsxs("div",{className:"flex items-start gap-1",children:[l&&e.jsx("button",{onClick:()=>C(s),className:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:n?"expand_more":"chevron_right"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["<",t.nodeName]}),o.length>0&&e.jsx("span",{children:o.map((u,j)=>e.jsxs("span",{children:[" ",e.jsx("span",{className:"text-orange-600 dark:text-orange-400",children:u.name}),"=",e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:['"',u.value,'"']})]},j))}),!l&&i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:">"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:i}),e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["</",t.nodeName,">"]})]}):l?e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:">"}):e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:" />"}),l&&n&&e.jsx("div",{className:"ml-4 border-l border-gray-300 dark:border-gray-600 pl-2 mt-1",children:Array.from(t.children).map((u,j)=>E(u,`${s}.${u.nodeName}[${j}]`,a+1))}),l&&e.jsx("div",{className:n?"":"hidden",children:e.jsxs("span",{className:"text-blue-600 dark:text-blue-400",children:["</",t.nodeName,">"]})})]})]})},s)},[v,C]);return e.jsxs("div",{className:"flex w-full flex-col items-center px-4 py-10 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex w-full max-w-6xl flex-col items-center gap-2 text-center mb-8",children:[e.jsx("p",{className:"text-3xl font-black leading-tight tracking-tighter text-gray-900 dark:text-white sm:text-4xl",children:"XML 格式化工具"}),e.jsx("p",{className:"text-base font-normal text-gray-500 dark:text-gray-400",children:"粘贴 XML 数据,自动格式化并以树形结构展示。"})]}),T&&e.jsx("div",{className:`fixed top-8 left-1/2 -translate-x-1/2 z-50 ${$?"animate-fade-out-up":"animate-fade-in-down"}`,children:e.jsxs("div",{className:"bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"check_circle"}),e.jsx("span",{className:"font-medium",children:"已复制到剪贴板!"})]})}),e.jsx("div",{className:"w-full max-w-6xl rounded-xl border border-gray-200 dark:border-gray-700/50 bg-white dark:bg-gray-800/20 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2",children:[e.jsxs("div",{className:"relative flex flex-col p-4 border-b lg:border-b-0 lg:border-r border-gray-200 dark:border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 min-h-[36px]",children:[e.jsxs("h3",{className:"text-gray-900 dark:text-white text-base font-semibold leading-normal flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"code"}),"原始 XML"]}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:[x.length," 字符"]})]}),e.jsx("textarea",{value:x,onChange:t=>X(t.target.value),className:"flex-1 resize-none rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50 text-gray-900 dark:text-gray-100 focus:outline-0 focus:ring-2 focus:ring-primary/20 focus:border-primary min-h-[400px] placeholder:text-gray-400 dark:placeholder:text-gray-500 p-4 text-sm leading-relaxed font-mono",placeholder:"在此处粘贴 XML 数据..."})]}),e.jsxs("div",{className:"relative flex flex-col p-4 bg-gray-50/50 dark:bg-gray-800/30",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3 min-h-[36px] gap-2",children:[e.jsxs("h3",{className:"text-gray-900 dark:text-white text-base font-semibold leading-normal flex items-center gap-2",children:[e.jsx("span",{className:"material-symbols-outlined text-xl",children:"account_tree"}),"树形视图"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:z,disabled:!d,className:"flex items-center gap-1 px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 rounded text-xs font-medium hover:bg-blue-200 dark:hover:bg-blue-900/50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors whitespace-nowrap",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"unfold_more"}),"展开"]}),e.jsxs("button",{onClick:F,disabled:!d,className:"flex items-center gap-1 px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 rounded text-xs font-medium hover:bg-orange-200 dark:hover:bg-orange-900/50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors whitespace-nowrap",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"unfold_less"}),"收起"]}),e.jsxs("button",{onClick:_,disabled:!d,className:"flex items-center gap-1 px-2 py-1 bg-primary/10 text-primary rounded text-xs font-medium hover:bg-primary/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors whitespace-nowrap",children:[e.jsx("span",{className:"material-symbols-outlined text-sm",children:"content_copy"}),"复制"]})]})]}),N&&e.jsxs("div",{className:"mb-2 p-2 bg-red-100 dark:bg-red-900/30 border border-red-200 dark:border-red-800 rounded text-xs text-red-600 dark:text-red-400",children:[e.jsx("span",{className:"material-symbols-outlined text-sm align-middle mr-1",children:"error"}),N]}),e.jsx("div",{className:"relative bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 min-h-[400px] p-4 text-sm overflow-auto",children:d&&d.documentElement?e.jsx("div",{className:"font-mono text-xs",children:E(d.documentElement,"root")}):N?null:e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400 dark:text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("span",{className:"material-symbols-outlined text-5xl mb-2 block opacity-50",children:"account_tree"}),e.jsx("p",{className:"text-sm",children:"格式化后的 XML 将显示在此处"})]})})})]})]})})]})};export{I as default};
